{{ define "content" }}
{{ $canEdit := or (hasRole .CurrentUserRoles "admin") (hasRole .CurrentUserRoles "editor") }}
<div class="card">
    <p class="breadcrumb"><a href="/ssg/get-site?id={{ .Site.ID }}">‚Üê {{ .Site.Name }}</a></p>
    <div class="card-header">
        <h1>Contents</h1>
        {{ if $canEdit }}<a href="/ssg/new-content?site_id={{ .Site.ID }}" class="btn">New Content</a>{{ end }}
    </div>

    <div class="search-box">
        <input type="search"
               name="q"
               placeholder="Search contents..."
               value="{{ .Search }}"
               hx-get="/ssg/list-contents?site_id={{ .Site.ID }}"
               hx-trigger="input changed delay:300ms, search"
               hx-target="#contents-table"
               hx-select="#contents-table"
               hx-push-url="true">
    </div>

    <div id="contents-table">
    {{ if .Contents }}
    <table>
        <thead>
            <tr>
                <th>Title</th>
                <th>Section</th>
                <th>Kind</th>
                <th>Status</th>
                {{ if $canEdit }}<th class="actions">Actions</th>{{ end }}
            </tr>
        </thead>
        <tbody>
            {{ range .Contents }}
            <tr class="clickable-row" onclick="window.location='/ssg/get-content?id={{ .ID }}&site_id={{ $.Site.ID }}'">
                <td>{{ .Heading }}</td>
                <td>{{ if .SectionName }}{{ .SectionName }}{{ else }}<em>None</em>{{ end }}</td>
                <td>{{ .Kind }}</td>
                <td>
                    {{ if .Draft }}<span class="badge badge-warning">Draft</span>{{ else }}<span class="badge badge-success">Published</span>{{ end }}
                    {{ if .Featured }}<span class="badge badge-info">Featured</span>{{ end }}
                </td>
                {{ if $canEdit }}
                <td class="actions">
                    <a href="/ssg/edit-content?id={{ .ID }}&site_id={{ $.Site.ID }}" class="btn btn-sm" onclick="event.stopPropagation()">Edit</a>
                </td>
                {{ end }}
            </tr>
            {{ end }}
        </tbody>
    </table>

    {{ if gt .TotalPages 1 }}
    <div class="pagination">
        {{ if .HasPrev }}
        <a href="?site_id={{ .Site.ID }}&page={{ subtract .CurrentPage 1 }}{{ if .Search }}&q={{ .Search }}{{ end }}" class="btn btn-sm">&larr; Previous</a>
        {{ end }}
        <span>Page {{ .CurrentPage }} of {{ .TotalPages }}</span>
        {{ if .HasNext }}
        <a href="?site_id={{ .Site.ID }}&page={{ add .CurrentPage 1 }}{{ if .Search }}&q={{ .Search }}{{ end }}" class="btn btn-sm">Next &rarr;</a>
        {{ end }}
    </div>
    {{ end }}
    {{ else }}
    <p class="empty-state">{{ if .Search }}No results for "{{ .Search }}".{{ else }}No content yet.{{ if $canEdit }} <a href="/ssg/new-content?site_id={{ .Site.ID }}">Create your first content</a>.{{ end }}{{ end }}</p>
    {{ end }}
    </div>

</div>
<script src="/static/js/vendor/htmx.min.js"></script>
{{ end }}
