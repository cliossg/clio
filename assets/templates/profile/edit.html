{{ define "content" }}
<div class="card">
    <p class="breadcrumb"><a href="/get-profile">&larr; Profile</a></p>
    <h1>Edit Profile</h1>

    {{ if .Error }}<div class="error">{{ .Error }}</div>{{ end }}

    <!-- Profile Photo Section -->
    <div class="form-group">
        <label>Profile Photo</label>
        <div style="display: flex; align-items: center; gap: 1rem;">
            {{ if .Profile.PhotoPath }}
            <img src="/get-profile-photo?filename={{ .Profile.PhotoPath }}" alt="Profile photo" style="width: 100px; height: 100px; object-fit: cover; border-radius: 50%; border: 2px solid var(--stone-beige);">
            <div>
                <button type="button" class="btn btn-secondary btn-sm" onclick="openPhotoModal()">Change Photo</button>
                <form method="POST" action="/remove-profile-photo" style="display: inline;">
                    <button type="submit" class="btn btn-danger btn-sm" onclick="return confirm('Remove profile photo?')">Remove</button>
                </form>
            </div>
            {{ else }}
            <div style="width: 100px; height: 100px; border-radius: 50%; background: var(--white-warm-dark); display: flex; align-items: center; justify-content: center; color: var(--stone-beige); font-size: 2rem; border: 2px dashed var(--stone-beige);">
                {{ slice .Profile.Name 0 1 }}
            </div>
            <button type="button" class="btn btn-secondary btn-sm" onclick="openPhotoModal()">Upload Photo</button>
            {{ end }}
        </div>
    </div>

    <form method="POST" action="/update-profile">
        <div class="form-group">
            <label for="slug">Slug</label>
            <input type="text" id="slug" name="slug" value="{{ .Profile.Slug }}" required>
            <small>URL-friendly identifier for your author page</small>
        </div>

        <div class="form-group">
            <label for="name">Name</label>
            <input type="text" id="name" name="name" value="{{ .Profile.Name }}" required>
        </div>

        <div class="form-group">
            <label for="surname">Surname</label>
            <input type="text" id="surname" name="surname" value="{{ .Profile.Surname }}">
        </div>

        <div class="form-group">
            <label for="bio">Bio</label>
            <textarea id="bio" name="bio" rows="4">{{ .Profile.Bio }}</textarea>
        </div>

        <div class="form-group">
            <label>Social Links</label>
            <table class="social-links-table">
                <tbody>
                    <tr><td><label for="social_facebook">Facebook</label></td><td><input type="text" id="social_facebook" name="social_facebook" value="{{ index .SocialLinksMap "facebook" }}" placeholder="https://facebook.com/..."></td></tr>
                    <tr><td><label for="social_youtube">YouTube</label></td><td><input type="text" id="social_youtube" name="social_youtube" value="{{ index .SocialLinksMap "youtube" }}" placeholder="https://youtube.com/..."></td></tr>
                    <tr><td><label for="social_instagram">Instagram</label></td><td><input type="text" id="social_instagram" name="social_instagram" value="{{ index .SocialLinksMap "instagram" }}" placeholder="https://instagram.com/..."></td></tr>
                    <tr><td><label for="social_x">X</label></td><td><input type="text" id="social_x" name="social_x" value="{{ index .SocialLinksMap "x" }}" placeholder="https://x.com/..."></td></tr>
                    <tr><td><label for="social_tiktok">TikTok</label></td><td><input type="text" id="social_tiktok" name="social_tiktok" value="{{ index .SocialLinksMap "tiktok" }}" placeholder="https://tiktok.com/..."></td></tr>
                    <tr><td><label for="social_linkedin">LinkedIn</label></td><td><input type="text" id="social_linkedin" name="social_linkedin" value="{{ index .SocialLinksMap "linkedin" }}" placeholder="https://linkedin.com/in/..."></td></tr>
                    <tr><td><label for="social_github">GitHub</label></td><td><input type="text" id="social_github" name="social_github" value="{{ index .SocialLinksMap "github" }}" placeholder="https://github.com/..."></td></tr>
                    <tr><td><label for="social_whatsapp">WhatsApp</label></td><td><input type="text" id="social_whatsapp" name="social_whatsapp" value="{{ index .SocialLinksMap "whatsapp" }}" placeholder="https://wa.me/..."></td></tr>
                    <tr><td><label for="social_telegram">Telegram</label></td><td><input type="text" id="social_telegram" name="social_telegram" value="{{ index .SocialLinksMap "telegram" }}" placeholder="https://t.me/..."></td></tr>
                    <tr><td><label for="social_reddit">Reddit</label></td><td><input type="text" id="social_reddit" name="social_reddit" value="{{ index .SocialLinksMap "reddit" }}" placeholder="https://reddit.com/u/..."></td></tr>
                </tbody>
            </table>

            <details class="form-details">
                <summary>More platforms</summary>
                <div>
                <table class="social-links-table">
                    <tbody>
                        <tr><td><label for="social_messenger">Messenger</label></td><td><input type="text" id="social_messenger" name="social_messenger" value="{{ index .SocialLinksMap "messenger" }}"></td></tr>
                        <tr><td><label for="social_snapchat">Snapchat</label></td><td><input type="text" id="social_snapchat" name="social_snapchat" value="{{ index .SocialLinksMap "snapchat" }}"></td></tr>
                        <tr><td><label for="social_pinterest">Pinterest</label></td><td><input type="text" id="social_pinterest" name="social_pinterest" value="{{ index .SocialLinksMap "pinterest" }}"></td></tr>
                        <tr><td><label for="social_tumblr">Tumblr</label></td><td><input type="text" id="social_tumblr" name="social_tumblr" value="{{ index .SocialLinksMap "tumblr" }}"></td></tr>
                        <tr><td><label for="social_discord">Discord</label></td><td><input type="text" id="social_discord" name="social_discord" value="{{ index .SocialLinksMap "discord" }}"></td></tr>
                        <tr><td><label for="social_twitch">Twitch</label></td><td><input type="text" id="social_twitch" name="social_twitch" value="{{ index .SocialLinksMap "twitch" }}"></td></tr>
                        <tr><td><label for="social_signal">Signal</label></td><td><input type="text" id="social_signal" name="social_signal" value="{{ index .SocialLinksMap "signal" }}"></td></tr>
                        <tr><td><label for="social_viber">Viber</label></td><td><input type="text" id="social_viber" name="social_viber" value="{{ index .SocialLinksMap "viber" }}"></td></tr>
                        <tr><td><label for="social_line">LINE</label></td><td><input type="text" id="social_line" name="social_line" value="{{ index .SocialLinksMap "line" }}"></td></tr>
                        <tr><td><label for="social_kakaotalk">KakaoTalk</label></td><td><input type="text" id="social_kakaotalk" name="social_kakaotalk" value="{{ index .SocialLinksMap "kakaotalk" }}"></td></tr>
                        <tr><td><label for="social_wechat">WeChat</label></td><td><input type="text" id="social_wechat" name="social_wechat" value="{{ index .SocialLinksMap "wechat" }}"></td></tr>
                        <tr><td><label for="social_qq">QQ</label></td><td><input type="text" id="social_qq" name="social_qq" value="{{ index .SocialLinksMap "qq" }}"></td></tr>
                        <tr><td><label for="social_douyin">Douyin</label></td><td><input type="text" id="social_douyin" name="social_douyin" value="{{ index .SocialLinksMap "douyin" }}"></td></tr>
                        <tr><td><label for="social_kuaishou">Kuaishou</label></td><td><input type="text" id="social_kuaishou" name="social_kuaishou" value="{{ index .SocialLinksMap "kuaishou" }}"></td></tr>
                        <tr><td><label for="social_weibo">Weibo</label></td><td><input type="text" id="social_weibo" name="social_weibo" value="{{ index .SocialLinksMap "weibo" }}"></td></tr>
                        <tr><td><label for="social_xiaohongshu">Xiaohongshu</label></td><td><input type="text" id="social_xiaohongshu" name="social_xiaohongshu" value="{{ index .SocialLinksMap "xiaohongshu" }}"></td></tr>
                        <tr><td><label for="social_bilibili">Bilibili</label></td><td><input type="text" id="social_bilibili" name="social_bilibili" value="{{ index .SocialLinksMap "bilibili" }}"></td></tr>
                        <tr><td><label for="social_zhihu">Zhihu</label></td><td><input type="text" id="social_zhihu" name="social_zhihu" value="{{ index .SocialLinksMap "zhihu" }}"></td></tr>
                        <tr><td><label for="social_vk">VK</label></td><td><input type="text" id="social_vk" name="social_vk" value="{{ index .SocialLinksMap "vk" }}"></td></tr>
                        <tr><td><label for="social_odnoklassniki">Odnoklassniki</label></td><td><input type="text" id="social_odnoklassniki" name="social_odnoklassniki" value="{{ index .SocialLinksMap "odnoklassniki" }}"></td></tr>
                        <tr><td><label for="social_mastodon">Mastodon</label></td><td><input type="text" id="social_mastodon" name="social_mastodon" value="{{ index .SocialLinksMap "mastodon" }}"></td></tr>
                        <tr><td><label for="social_bluesky">Bluesky</label></td><td><input type="text" id="social_bluesky" name="social_bluesky" value="{{ index .SocialLinksMap "bluesky" }}"></td></tr>
                        <tr><td><label for="social_threads">Threads</label></td><td><input type="text" id="social_threads" name="social_threads" value="{{ index .SocialLinksMap "threads" }}"></td></tr>
                        <tr><td><label for="social_flickr">Flickr</label></td><td><input type="text" id="social_flickr" name="social_flickr" value="{{ index .SocialLinksMap "flickr" }}"></td></tr>
                        <tr><td><label for="social_vimeo">Vimeo</label></td><td><input type="text" id="social_vimeo" name="social_vimeo" value="{{ index .SocialLinksMap "vimeo" }}"></td></tr>
                        <tr><td><label for="social_dailymotion">Dailymotion</label></td><td><input type="text" id="social_dailymotion" name="social_dailymotion" value="{{ index .SocialLinksMap "dailymotion" }}"></td></tr>
                        <tr><td><label for="social_quora">Quora</label></td><td><input type="text" id="social_quora" name="social_quora" value="{{ index .SocialLinksMap "quora" }}"></td></tr>
                    </tbody>
                </table>
                </div>
            </details>
        </div>

        <div class="form-actions">
            <button type="submit" class="btn btn-primary">Save</button>
            <a href="/get-profile" class="btn">Cancel</a>
        </div>
    </form>
</div>

<!-- Photo Upload Modal -->
<div id="photo-modal" class="modal-overlay hidden">
    <div class="modal-content" style="max-width: 24rem;">
        <div class="modal-header">
            <h2>Upload Photo</h2>
            <button type="button" class="modal-close" onclick="closePhotoModal()">&times;</button>
        </div>
        <form method="POST" action="/upload-profile-photo" enctype="multipart/form-data">
            <div class="form-group">
                <label for="photo">Select Image</label>
                <div class="file-input-wrapper">
                    <button type="button" class="btn btn-secondary">Choose File</button>
                    <input type="file" id="photo" name="photo" accept="image/*" required onchange="updateFileName(this)">
                </div>
                <small id="photo-filename" style="display: block; margin-top: 0.5rem; color: var(--navy-deep);"></small>
                <small style="color: var(--stone-beige);">Recommended: Square image, at least 200x200 pixels</small>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" onclick="closePhotoModal()">Cancel</button>
                <button type="submit" class="btn btn-primary">Upload</button>
            </div>
        </form>
    </div>
</div>

<script>
function openPhotoModal() {
    document.getElementById('photo-modal').classList.remove('hidden');
}

function closePhotoModal() {
    document.getElementById('photo-modal').classList.add('hidden');
    // Reset file input and filename display when closing
    document.getElementById('photo').value = '';
    document.getElementById('photo-filename').textContent = '';
}

function updateFileName(input) {
    const filenameDisplay = document.getElementById('photo-filename');
    if (input.files && input.files.length > 0) {
        filenameDisplay.textContent = input.files[0].name;
    } else {
        filenameDisplay.textContent = '';
    }
}

document.getElementById('photo-modal').addEventListener('click', function(e) {
    if (e.target === this) closePhotoModal();
});

document.addEventListener('keydown', function(e) {
    if (e.key === 'Escape') closePhotoModal();
});
</script>
{{ end }}
